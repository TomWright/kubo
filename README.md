# kubo

[![Go Report Card](https://goreportcard.com/badge/github.com/TomWright/kubo)](https://goreportcard.com/report/github.com/TomWright/kubo)
[![Documentation](https://godoc.org/github.com/TomWright/kubo?status.svg)](https://godoc.org/github.com/TomWright/kubo)
![Test](https://github.com/TomWright/kubo/workflows/Test/badge.svg)
![Build](https://github.com/TomWright/kubo/workflows/Build/badge.svg)

A simple utility to help with kubernetes manifest management and deployment.

## Installation

If you have go installed you can use:
```
go get github.com/tomwright/kubo/cmd/kubo
```

Alternatively you can download a compiled executable from the [latest release](https://github.com/TomWright/kubo/releases/latest).

```
$ kubo
A small helper to manage kubernetes configurations.

Usage:
  kubo [command]

Available Commands:
  apply       Apply kubernetes manifests for the given service and environment.
  generate    Generate kubernetes manifests for the given service, template and environment.
  help        Help about any command
  update      Update config files that are used during manifest generation.

Flags:
  -b, --base string          Full path to kubo base directory. (default ".")
  -e, --environment string   The environment to work with. (default "default")
  -h, --help                 help for kubo

Use "kubo [command] --help" for more information about a command.
```

## Structure

All kubo managed files are expected to be in the following structure.

```
- base
-- config
--- {SERVICE}
---- {NAMESPACE}
----- {TEMPLATE}.yaml
----- ...
-- templates
--- {TEMPLATE}
---- deployment.yaml
---- cluster-ip.yaml
---- ...
-- k8s
--- {SERVICE}
---- {NAMESPACE}
----- deployment.yaml
----- cluster-ip.yaml
----- ...
```

## Example

There is a basic example within the [example](/example) directory.

You can clone this repo, change some values and re-generate the example with:
```
kubo generate -b ./example -e production user
```

## Templates
Contains the manifest file templates for a given service in a given environment.

Supports all functionality provided by Go's [text/template](https://golang.org/pkg/text/template/) package.

Basic replacements can be done using `{{ .name }}` or `{{ .image.version }}` for object access.

## Config
Contains the values used when parsing the templates.

The name of the config file should match the name of the template you are generating.

You can update these files directly, or by using the `kubo` commandline tool:

```
kubo update -e development -v http.port=8080 -v image.version=v1.0.0 auth
```

The above updates the `service.yaml` template config within the `development` environment, for the service `auth`.

If you want to change the values for a different template you can pass `-t <template name>`.

### Types

There are different arguments available to allow you to specifically store values as different types.

- `-v <name>=<value>` - No parsing is done. Values will be stored as a string since they are given from a command line string.
- `-s <name>=<value>` - String value.
- `-n <name>=<value>` - Int value.
- `-b <name>=<value>` - Bool value. (`true`, `yes`, `t`, `y`, `1`, `false`, `no`, `n`, `0`)

## k8s

The k8s directory contains of the manifests generated by kubo.

You can generate these manifests with the following command.

```
kubo generate -e development auth
```

The above generates the manifests for the `auth` service within the `development` environment.

By default, it uses the `service` template, but you can change this using `-t <template name>`.

## Base path

The base path within kubo is important.

By default, the working directory is used.

If however you want to use kubo from a different directory you can use `-b <base path>` in any of the commands.

```
kubo generate -b ~/kubo/base -e development auth
```
